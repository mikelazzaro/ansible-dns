---

- name: Install various required packages
  apt:
    name: "{{ item }}"
    state: latest
  with_items:
    - bind9
    - bind9utils
    - dnsutils
#    - bind9-host

- name: Modify resolv.conf generation process
  copy:
    src: "resolvconf_head"
    dest: "/etc/resolvconf/resolv.conf.d/head"
    owner: root
    group: root
    mode: "0644"

- name: Deploy static config files
  copy:
    src: "{{ item }}"
    dest: "/etc/bind/{{ item }}"
    owner: root
    group: bind
    mode: "0644"
  with_items:
    - db.corp
    - db.global.corp
    - named.conf.local
    - named.conf.options

- name: Restart bind
  service:
    name: bind9
    state: restarted