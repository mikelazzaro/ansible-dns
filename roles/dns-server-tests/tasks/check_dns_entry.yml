- name: Perform nslookup for domain
  command: "nslookup {{ item.domain }} localhost"
  register: nslookup_result

- name: Fail if results don't match
  fail:
    msg: "nslookup worked, but did not return expected address: '{{ nslookup_result.stdout_lines }}'"
  when: item.address not in nslookup_result.stdout_lines[-1]
